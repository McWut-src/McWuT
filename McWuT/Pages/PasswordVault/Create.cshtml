@page
@model McWuT.Web.Pages.PasswordVault.CreateModel
@{
    ViewData["Title"] = "Add Password Entry";
}

<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card shadow">
                <div class="card-header">
                    <h4 class="mb-0">
                        <i class="bi bi-plus-circle me-2"></i>Add Password Entry
                    </h4>
                </div>
                <div class="card-body">
                    <form method="post">
                        <div asp-validation-summary="ModelOnly" class="text-danger mb-3" role="alert"></div>
                        
                        <div class="mb-3">
                            <label asp-for="Input.Name" class="form-label">
                                <i class="bi bi-tag me-1"></i>@Html.DisplayNameFor(m => m.Input.Name) <span class="text-danger">*</span>
                            </label>
                            <input asp-for="Input.Name" class="form-control" placeholder="e.g., My Gmail Account, Work VPN, etc." />
                            <span asp-validation-for="Input.Name" class="text-danger"></span>
                            <div class="form-text">
                                <small>A descriptive name to identify this entry.</small>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Input.Website" class="form-label">
                                <i class="bi bi-globe me-1"></i>@Html.DisplayNameFor(m => m.Input.Website)
                            </label>
                            <input asp-for="Input.Website" class="form-control" placeholder="e.g., google.com, facebook.com" />
                            <span asp-validation-for="Input.Website" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Input.Username" class="form-label">
                                <i class="bi bi-person me-1"></i>@Html.DisplayNameFor(m => m.Input.Username)
                            </label>
                            <input asp-for="Input.Username" class="form-control" placeholder="Username or email address" />
                            <span asp-validation-for="Input.Username" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Input.Password" class="form-label">
                                <i class="bi bi-key me-1"></i>@Html.DisplayNameFor(m => m.Input.Password)
                            </label>
                            <div class="input-group">
                                <input asp-for="Input.Password" class="form-control" type="password" id="passwordInput" />
                                <button type="button" class="btn btn-outline-secondary" onclick="togglePasswordVisibility()">
                                    <i class="bi bi-eye" id="passwordToggleIcon"></i>
                                </button>
                                <button type="button" class="btn btn-outline-info" onclick="generatePassword()">
                                    <i class="bi bi-arrow-clockwise"></i> Generate
                                </button>
                            </div>
                            <span asp-validation-for="Input.Password" class="text-danger"></span>
                            <div class="form-text">
                                <small>Use a strong, unique password. Click Generate for a secure password suggestion.</small>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Input.Category" class="form-label">
                                <i class="bi bi-tag me-1"></i>@Html.DisplayNameFor(m => m.Input.Category)
                            </label>
                            <input asp-for="Input.Category" class="form-control" list="categoryOptions" placeholder="e.g., Social Media, Banking, Work" />
                            <datalist id="categoryOptions">
                                <option value="Social Media"></option>
                                <option value="Banking"></option>
                                <option value="Work"></option>
                                <option value="Email"></option>
                                <option value="Shopping"></option>
                                <option value="Entertainment"></option>
                                <option value="Utilities"></option>
                                <option value="Other"></option>
                            </datalist>
                            <span asp-validation-for="Input.Category" class="text-danger"></span>
                        </div>

                        <div class="mb-4">
                            <label asp-for="Input.Notes" class="form-label">
                                <i class="bi bi-journal-text me-1"></i>@Html.DisplayNameFor(m => m.Input.Notes)
                            </label>
                            <textarea asp-for="Input.Notes" class="form-control" rows="3" placeholder="Additional notes or security questions..."></textarea>
                            <span asp-validation-for="Input.Notes" class="text-danger"></span>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a asp-page="./Index" class="btn btn-outline-secondary me-md-2">
                                <i class="bi bi-arrow-left me-1"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-shield-plus me-1"></i>Save Entry
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    <script>
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('passwordInput');
            const toggleIcon = document.getElementById('passwordToggleIcon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.className = 'bi bi-eye-slash';
            } else {
                passwordInput.type = 'password';
                toggleIcon.className = 'bi bi-eye';
            }
        }

        function generatePassword() {
            const length = 16;
            const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!#$%^&*()_+-=[]{}|;:,.<>?";
            let password = "";
            
            // Ensure at least one character from each category
            const lowercase = "abcdefghijklmnopqrstuvwxyz";
            const uppercase = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            const numbers = "0123456789";
            const symbols = "!#$%^&*()_+-=[]{}|;:,.<>?";
            
            password += lowercase[Math.floor(Math.random() * lowercase.length)];
            password += uppercase[Math.floor(Math.random() * uppercase.length)];
            password += numbers[Math.floor(Math.random() * numbers.length)];
            password += symbols[Math.floor(Math.random() * symbols.length)];
            
            // Fill the rest randomly
            for (let i = 4; i < length; i++) {
                password += charset[Math.floor(Math.random() * charset.length)];
            }
            
            // Shuffle the password
            password = password.split('').sort(() => Math.random() - 0.5).join('');
            
            document.getElementById('passwordInput').value = password;
            
            // Show password temporarily
            const passwordInput = document.getElementById('passwordInput');
            const toggleIcon = document.getElementById('passwordToggleIcon');
            passwordInput.type = 'text';
            toggleIcon.className = 'bi bi-eye-slash';
        }
    </script>
}